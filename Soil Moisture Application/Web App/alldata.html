<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello World Title</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
Hello World
<div id="graph"></div>
<p id="data"></p>
</body>
<!--<script src="graph.js"></script>-->
<script>
    function rand() {
        return Math.random();
    }

    var layout = {
        title: 'Temperature',
        xaxis: {
            title: 'Time',
            titlefont: {
                family: 'Courier New, monospace',
                size: 18,
                color: '#7f7f7f'
            }
        },
        yaxis: {
            title: 'Celsius',
            titlefont: {
                family: 'Courier New, monospace',
                size: 18,
                color: '#7f7f7f'
            }
        }
    };
    /*Plotly.plot('graph', [{
        y: [1,2,3].map(rand),
        mode: 'lines',
        line: {color: '#80CAF6'}
    }]);*/

    var cnt = 0;
    var i = 0;
    var xhttp = new XMLHttpRequest();
    xhttp.open("GET", "http://18.221.30.192/data", true);
    xhttp.onreadystatechange = function(){
        if(xhttp.readyState == 4 && xhttp.status == 200){
            /*console.log(xhttp.responseText);*/
            var sensorData = xhttp.responseText;
            var records = JSON.parse(sensorData);
            var sensorZeroTemps = [];
            var sensorZeroTimes = [];
            var sensorOneTemps = [];
            var sensorOneTimes = [];
            var sensorTwoTemps = [];
            var sensorTwoTimes = [];
            for(i = 0; i < records[0].length; i++){
                sensorZeroTemps.push(records[0][i].value);
                sensorZeroTimes.push(records[0][i].date);
            }

            for(i = 0; i < records[1].length; i++){
                sensorOneTemps.push(records[1][i].value);
                sensorOneTimes.push(records[1][i].date);
            }

            for(i = 0; i < records[2].length; i++){
                sensorTwoTemps.push(records[2][i].value);
                sensorTwoTimes.push(records[2][i].date);
            }

            /*var time = new Date();*/
            var sensorZeroTrace = {
                x: sensorZeroTimes,
                y: sensorZeroTemps,
                mode: 'lines+markers',
                type: 'scatter',
                name: 'Sensor Zero'
                /*mode: 'lines',*/
                /*line: {color: '#80CAF6'}*/
            };

            var sensorOneTrace = {
                x: sensorOneTimes,
                y: sensorOneTemps,
                mode: 'lines+markers',
                type: 'scatter',
                name: 'Sensor One'
                /*mode: 'lines',*/
                /*line: {color: '#80CAF6'}*/
            };

            var sensorTwoTrace = {
                x: sensorTwoTimes,
                y: sensorTwoTemps,
                mode: 'lines+markers',
                type: 'scatter',
                name: 'Sensor One'
                /*mode: 'lines',*/
                /*line: {color: '#80CAF6'}*/
            };

            var allTraces = [sensorZeroTrace, sensorOneTrace, sensorTwoTrace];
            Plotly.plot('graph', allTraces, layout);

            document.getElementById("data").innerHTML = JSON.stringify(records[0][0])+ " " + records[0].length;
        }
    };
    xhttp.send();
</script>
</html>