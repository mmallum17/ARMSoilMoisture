<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello World Title</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
Hello World
<div id="graph"></div>
<p id="data"></p>
</body>
<!--<script src="graph.js"></script>-->
<script>
    function rand() {
        return Math.random();
    }

    /*Plotly.plot('graph', [{
        y: [1,2,3].map(rand),
        mode: 'lines',
        line: {color: '#80CAF6'}
    }]);*/

    var cnt = 0;
    var xhttp = new XMLHttpRequest();
    xhttp.open("GET", "http://18.221.30.192/data", true);
    xhttp.onreadystatechange = function(){
        if(xhttp.readyState == 4 && xhttp.status == 200){
            /*console.log(xhttp.responseText);*/
            var records = JSON.parse(xhttp.responseText);
            var temps = [];
            var times = [];
            for(var i = 0; i < records.length; i++){
                temps.push(records[i].value);
                times.push(records[i].date);
            }

            /*var time = new Date();*/
            var data = [{
               x: times,
               y: temps,
               mode: 'lines',
               line: {color: '#80CAF6'}
            }];
            Plotly.plot('graph', data);
            /*Plotly.plot('graph', [{
                y: [1,2,3].map(rand),
                mode: 'lines',
                line: {color: '#80CAF6'}
            }]);*/
            /*Plotly.plot('graph', [{
                x: [times[0]],
                y: [temps[0]],
                mode: 'lines',
                line: {color: '#80CAF6'}
            }]);*/
            /*var data = [
                {
                    x: times,
                    y: temps,
                    type: 'scatter'
                }
            ];*/
            /*Plotly.newPlot('graph', data);*/
            /*var interval = setInterval(function() {

                Plotly.extendTraces('graph', {
                    x: [new Date()],
                    y: [[rand()]]
                }, [0]);

                if(cnt === 100) clearInterval(interval);
            }, 300);*/
            var cnt = 0;
            var interval = setInterval(function() {
                var time = new Date();
                var update = {
                    x: [[time]],
                    y: [[rand()]]
                };

                Plotly.extendTraces('graph', update, [0]);
                cnt++;
                if(cnt === 20) clearInterval(interval);
            }, 1000);
            /*Plotly.plot('graph', [{
                y: temps,
                mode: 'lines',
                line: {color: '#80CAF6'}
            }]);*/
            document.getElementById("data").innerHTML = records[0].value + " " + records.length;
        }
    };
    xhttp.send();
</script>
</html>